#!/bin/sh
set -e


. /usr/share/debconf/confmodule

if [ -n "$1" ]; then
    APP=$1
	db_get composer/WEB_USER || true
	WEB_USER=$(echo $RET | awk -F: '{print $1}')
	WEB_GROUP=$(echo $RET | awk -F: '{print $2}')

	id -u $WEB_USER &>/dev/null || useradd $WEB_USER

	if [ -z $WEB_GROUP ] ; then
	    chown $WEB_USER /var/lib/composer/ /usr/lib/$APP -Rv
	else
	    id -g $WEB_GROUP &>/dev/null || groupadd $WEB_USER
	    mkdir -p /usr/lib/$APP
	    chown $WEB_USER:$WEB_GROUP /var/lib/composer/ /usr/lib/$APP -Rv
	fi

	echo '{}' > /usr/lib/$APP/composer.lock
	chown $WEB_USER /usr/lib/$APP/composer.lock
	su - $WEB_USER -s /bin/bash -c 'COMPOSER_HOME="/var/lib/composer" composer -o install -d /usr/lib/$APP/'

    

else
  echo "please call me with app name"
fi


